name: Deploy to Staging
on:
  workflow_dispatch:
jobs:
  deploy-staging:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Login to GHCR
        run: |
          echo {{ secrets.GHCR_TOKEN }} | docker login ghcr.io \
            -u {{ github.actor }} --password-stdin

      - name: Build Docker image
        run: |
          docker build -f docker/Dockerfile \
           -t ghcr.io/{{ github.repository_owner }}/gas:staging-$${{ github.sha }} .

      - name: Push Docker image
        run: |
          docker push ghcr.io/$${{ github.repository_owner }}/gas:staging-$${{ github.sha }}

      - name: Deploy to Azure Staging Slot
        run: |
          echo "Would run az webapp deployment here"
